set(LCI_PM_BACKEND pmi1 CACHE STRING "Process management backend to use")
set_property(CACHE LCI_PM_BACKEND PROPERTY STRINGS pmi1 pmi2 mpi)

set(LIBRARY_NAME LCI)
if(LCI_PM_BACKEND STREQUAL "pmi1")
    target_sources_relative(${LIBRARY_NAME} PRIVATE pmi_wrapper_pmi1.c)
    add_subdirectory(pmi1)
elseif(LCI_PM_BACKEND STREQUAL "pmi2")
    target_sources_relative(${LIBRARY_NAME} PRIVATE pmi_wrapper_pmi2.c)
    add_subdirectory(pmi2)
elseif(LCI_PM_BACKEND STREQUAL "mpi")
    find_package(MPI REQUIRED)
    target_sources_relative(${LIBRARY_NAME} PRIVATE pmi_wrapper_mpi.c)
    cmake_policy(SET CMP0079 NEW)
    target_link_libraries(${LIBRARY_NAME} PRIVATE MPI::MPI_C)
#elseif(LCI_PM_BACKEND STREQUAL "file")
else()
    message(FATAL_ERROR "LCI_PM_BACKEND ${LCI_PM_BACKEND} not supported")
endif()
target_include_directories(${LIBRARY_NAME} PRIVATE .)
